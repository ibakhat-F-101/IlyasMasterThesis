VAGRANT_CONFIG_VERSION = "2"
ANSIBLE_COMPATIBILITY_MODE = "2.13"
VM_NAME_VB = "cyber"
VM_HOSTNAME = "vagrant"
BOX_RAM_MB = "4096"
BOX_CPUS_COUNT = 4
STATIC_IP = "10.10.15.12"
PATH_TO_PASSWORD_VAULT = "user_group_vars/password_vault/password_vault.txt"
BOX_BASE = "antitrust-ageless-custard-unreached/janus"

# Function to provision services with Ansible
def provision_with_ansible(cyber, service)
  playbook_path = "#{service}/#{service}.yml"
  cyber.vm.provision "ansible" do |ans|
    ans.compatibility_mode = "2.0"
    ans.playbook = playbook_path
    ans.inventory_path = "inventory/inventory.ini"
    ans.verbose = "v"
    ans.vault_password_file = PATH_TO_PASSWORD_VAULT
  end
end

Vagrant.configure(VAGRANT_CONFIG_VERSION) do |config|
  config.vm.define VM_NAME_VB do |cyber|
    # Basic VM config
    cyber.vm.box = BOX_BASE
    cyber.vm.hostname = VM_HOSTNAME
    cyber.vm.post_up_message = File.read("post_up_message.txt")
    cyber.vm.network "private_network", ip: STATIC_IP

  # VirtualBox specific config
  cyber.vm.provider "virtualbox" do |vb|
    vb.gui = false
    vb.name = VM_NAME_VB
    vb.memory = BOX_RAM_MB
    vb.cpus = BOX_CPUS_COUNT
  end

  cyber.vm.provision "ansible" do |ans|
    ans.compatibility_mode = "2.0"
    ans.inventory_path = "inventory/inventory.ini"
    ans.playbook = "common/common.yml"
    ans.verbose = "v"
  end 

  services_to_provision = [] 
  services_to_provision.each do |service|
    provision_with_ansible(cyber, service)
  end
end
end
  




