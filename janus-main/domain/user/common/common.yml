---
- name: Common tasks
  hosts: 127.0.0.1
  gather_facts: false
  connection: local

  tasks:
    - name: Install bcrypt
      become: true
      ansible.builtin.apt:
        name: python3-bcrypt
        state: present

    - name: Install passlib
      become: true
      ansible.builtin.apt:
        name: python3-passlib
        state: present

    - name: Randomize password
      command: 'ansible-playbook /janus/domain/user/user_group_vars/secure_vault.yml'
      retries: 3
      delay: 3
      register: result
      until: result.rc == 0

    ########################################
    - name: Restart networking service
      become: true
      service:
        name: networking
        state: restarted
    ########################################
    - name: Restart Docker service
      become: true
      service:
        name: docker
        state: restarted
